syntax = "proto3";
import "google/protobuf/empty.proto";

message Metric {
  float cpu = 1;
  float memory = 2;
}

message Handshake {
  string ip_address = 1;
  string namespace = 2;
  string api_key = 3;
}

message FailureReport {
  string namespace = 1;
  string ip_address = 2;
}

message IPRequest {
  string client_ip_address = 1;
  string namespace = 2;
}

message AgentRegistrationResponse {
  string service_id = 1;
}

message AgentRegistrationRequest {
  string api_key = 1;
  string namespace = 2;
}

message LookupRequest {
  string namespace = 1;
}

message LookupResponse {
  string ip_address = 1;
  string namespace = 2;
}

message FailureReportRequest {
  string ip_address = 1;
  string namespace = 2;
}

message HeartbeatRequest {
  float cpu_usage = 1;
  float memory_usage = 2;
  string namespace = 3;
}

message HeartbeatResponse {
  repeated Node unhealthy_services = 1;
}

message Node {
  string id = 1;
  string namespace = 2;
}

service Horbo {
  rpc RegisterAgent(AgentRegistrationRequest) returns (AgentRegistrationResponse);
  rpc ServiceLookup(LookupRequest) returns (LookupResponse);
  rpc ServiceFailureReport(FailureReportRequest) returns (google.protobuf.Empty);
  rpc Heartbeat(HeartbeatRequest) returns (HeartbeatResponse);
}